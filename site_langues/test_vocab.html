<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Test Vocab</title></head>
<body>
<h1>Test de la fonction highlightVocabInText</h1>
<pre id="output"></pre>
<script>
// Copie de la fonction depuis player.html
function highlightVocabInText(text, vocabList) {
    let highlightedText = text;
    const normalizeWord = (w) => {
        let word = (w || '').toString();
        word = word.replace(/^(le|la|les|l'|der|die|das|el|los|las|un|una|uno|unos|unas|de|het|il|lo|gli|le|i|un'|l')\s+/i, '');
        word = word.replace(/^to\s+/i, '');
        word = word.replace(/\*/g, '');
        if (word.includes('→')) word = word.split('→')[0].trim();
        return word.trim();
    };
    const transByWord = new Map();
    vocabList.forEach(item => {
        const key = normalizeWord(item.word).toLowerCase();
        if (key.length > 2 && !transByWord.has(key)) {
            transByWord.set(key, (item.translation || '').toString());
        }
    });
    const uniqueWords = Array.from(transByWord.keys()).sort((a, b) => b.length - a.length);
    uniqueWords.forEach(word => {
        const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const regex = new RegExp(`(^|[^\\wÀ-ÿ'])(${escapedWord})(?=$|[^\\wÀ-ÿ'])`, 'gi');
        highlightedText = highlightedText.replace(regex, (_m, p1, p2) => {
            const k = normalizeWord(p2).toLowerCase();
            let tr = transByWord.get(k) || '';
            if (tr) {
                tr = tr.replace(/"/g, '&quot;');
            }
            const titleAttr = tr ? ` title="${tr}"` : '';
            const dataAttr = tr ? ` data-translation="${tr}"` : '';
            return `${p1}<span class="vocab-highlight"${titleAttr}${dataAttr}>${p2}</span>`;
        });
    });
    return highlightedText;
}

const text = "My name is John. I go to school.";
const vocab = [{word: "name", translation: "nom"}, {word: "school", translation: "école"}];
const result = highlightVocabInText(text, vocab);
document.getElementById('output').textContent = result;
console.log("Result:", result);
</script>
</body>
</html>
